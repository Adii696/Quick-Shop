const nodemailer = require('nodemailer'); const User = require('../models/User'); async function sendOrderEmail(userId, order){ try{ const user = await User.findById(userId); if(!user || !user.email) return; const host = process.env.EMAIL_HOST; if(!host) { console.log('Email host not configured, skipping'); return; } const transporter = nodemailer.createTransport({ host: process.env.EMAIL_HOST, port: Number(process.env.EMAIL_PORT) || 587, secure: false, auth: { user: process.env.EMAIL_USER, pass: process.env.EMAIL_PASS } }); const items = order.orderItems.map(it=> `<li>${it.qty} x ${it.product || it.title} - ₹${it.price*it.qty}</li>`).join(''); const html = `<p>Hi ${user.name},</p><p>Order id: ${order._id}</p><ul>${items}</ul><p>Total: ₹${order.total}</p>`; await transporter.sendMail({ from: process.env.EMAIL_USER, to: user.email, subject: 'Your QuickShop order', html }); }catch(err){ console.error('sendOrderEmail failed', err);} } module.exports = sendOrderEmail;
